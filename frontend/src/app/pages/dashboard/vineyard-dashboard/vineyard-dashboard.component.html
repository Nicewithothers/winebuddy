<section class="section-container">
    <div class="w-full h-full flex flex-col justify-center">
        <div class="h-full p-4">
            <div
                class="h-[80vh] w-full rounded-xl shadow border border-gray-200 z-10"
                leaflet
                leafletDraw
                [leafletOptions]="options"
                [leafletDrawOptions]="getDrawFeatures()"
                (leafletMapReady)="onMapReady($event)"
                (leafletDrawReady)="onDrawReady($event)"
            >
                @if (this.authService.user$ | async; as user) {
                    @if (user.vineyard) {
                        <div class="leaflet-top leaflet-right p-4">
                            <button
                                hlmBtn
                                variant="default"
                                size="sm"
                                class="pointer-events-auto cursor-pointer"
                                [brnMenuTriggerFor]="actionMenu"
                            >
                                <ng-icon hlm name="lucideMenu" size="sm"></ng-icon>
                            </button>
                        </div>
                        <ng-template #actionMenu>
                            <hlm-menu>
                                <button
                                    variant="destructive"
                                    class="cursor-pointer"
                                    hlmMenuItem
                                    [brnAlertDialogTriggerFor]="deleteDialog"
                                >
                                    <ng-icon hlm size="sm" name="lucideX" />
                                    Delete vineyard
                                </button>
                            </hlm-menu>
                        </ng-template>
                        <hlm-alert-dialog #deleteDialog>
                            <hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
                                <hlm-alert-dialog-header>
                                    <h3 hlmAlertDialogTitle>Are you sure?</h3>
                                    <p hlmAlertDialogDescription>
                                        If you delete your vineyard, all of your other assets will
                                        be gone as well!
                                    </p>
                                </hlm-alert-dialog-header>
                                <hlm-alert-dialog-footer>
                                    <button
                                        class="cursor-pointer"
                                        hlmAlertDialogCancel
                                        (click)="ctx.close()"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        class="cursor-pointer"
                                        hlmAlertDialogAction
                                        (click)="deleteVineyard()"
                                    >
                                        Continue
                                    </button>
                                </hlm-alert-dialog-footer>
                            </hlm-alert-dialog-content>
                        </hlm-alert-dialog>
                    }
                }
            </div>
            <hlm-dialog [state]="dialogService._state()">
                <hlm-dialog-content *brnDialogContent>
                    <hlm-dialog-header>
                        <h3 class="text-center" hlmDialogTitle>Add vineyard</h3>
                        <p hlmDialogDescription>
                            IMPORTANT: You need to draw on the map before adding!
                        </p>
                    </hlm-dialog-header>
                    <form [formGroup]="vineyardForm" (ngSubmit)="addVineyard()">
                        <div class="flex flex-col items-center gap-y-2">
                            <hlm-form-field>
                                <input
                                    class="w-64"
                                    type="text"
                                    placeholder="Vineyard name"
                                    formControlName="name"
                                    hlmInput
                                />
                            </hlm-form-field>
                            <div class="flex gap-6">
                                <button
                                    variant="destructive"
                                    hlmBtn
                                    type="reset"
                                    class="cursor-pointer"
                                    (click)="closeDialog()"
                                >
                                    Close
                                </button>
                                <button
                                    variant="default"
                                    hlmBtn
                                    type="submit"
                                    class="cursor-pointer"
                                    [disabled]="checkFields()"
                                >
                                    Create
                                </button>
                            </div>
                        </div>
                    </form>
                </hlm-dialog-content>
            </hlm-dialog>
        </div>
    </div>
</section>
